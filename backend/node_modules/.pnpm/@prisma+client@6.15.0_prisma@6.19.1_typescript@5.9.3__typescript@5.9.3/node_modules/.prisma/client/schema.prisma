enum Role {
  USER
  ADMIN
}

enum TravelType {
  SOLO
  FRIENDS
  FAMILY
  COUPLE
  GROUP
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
  CANCELLED
}

model MatchRequest {
  id           Int        @id @default(autoincrement())
  senderId     Int
  receiverId   Int
  travelPlanId Int
  message      String?
  status       String     @default("PENDING")
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  receiver     User       @relation("ReceiverRequests", fields: [receiverId], references: [id])
  sender       User       @relation("SenderRequests", fields: [senderId], references: [id])
  travelPlan   TravelPlan @relation(fields: [travelPlanId], references: [id])

  @@unique([senderId, travelPlanId])
  @@index([receiverId])
}

model Payment {
  id        Int           @id @default(autoincrement())
  userId    Int
  amount    Float
  status    PaymentStatus @default(PENDING)
  tranId    String        @unique
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  user      User          @relation(fields: [userId], references: [id])
}

model Review {
  id           Int        @id @default(autoincrement())
  reviewerId   Int
  reviewedId   Int
  travelPlanId Int
  rating       Int
  comment      String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  reviewed     User       @relation("UserReviewsReceived", fields: [reviewedId], references: [id])
  reviewer     User       @relation("UserReviewsGiven", fields: [reviewerId], references: [id])
  travelPlan   TravelPlan @relation(fields: [travelPlanId], references: [id])

  @@index([reviewerId])
  @@index([reviewedId])
  @@index([travelPlanId])
}

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TravelPlan {
  id            Int            @id @default(autoincrement())
  title         String
  destination   String
  startDate     DateTime
  endDate       DateTime
  minBudget     Int?
  maxBudget     Int?
  travelType    TravelType
  description   String?
  itinerary     Json?
  latitude      Float?
  longitude     Float?
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  userId        Int
  image         String?
  matchRequests MatchRequest[]
  reviews       Review[]
  user          User           @relation(fields: [userId], references: [id])

  @@index([destination])
  @@index([startDate, endDate])
  @@index([userId])
}

model User {
  id               Int            @id @default(autoincrement())
  fullName         String
  email            String         @unique
  password         String
  role             Role           @default(USER)
  profileImage     String?
  bio              String?
  travelInterests  String[]
  visitedCountries String[]
  currentLocation  String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  premium          Boolean        @default(false)
  receivedRequests MatchRequest[] @relation("ReceiverRequests")
  sentRequests     MatchRequest[] @relation("SenderRequests")
  payments         Payment[]
  reviewsReceived  Review[]       @relation("UserReviewsReceived")
  reviewsGiven     Review[]       @relation("UserReviewsGiven")
  travelPlans      TravelPlan[]
}
